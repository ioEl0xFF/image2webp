# img2webp

📄 **DOCXファイルから画像名を抽出し、WebP形式に変換するPythonツール**

Word文書内のテーブルから画像名を自動抽出し、複数サイズのWebP画像を生成します。Webサイト用の画像最適化に最適です。

## ✨ 主な機能

- 🔍 **自動画像名抽出**: DOCXファイル内のテーブルから画像名を自動検出
- 🖼️ **複数サイズ変換**: 設定に基づいて複数のサイズでWebP画像を生成
- 📐 **アスペクト比保持**: 元画像の比率を維持しながらリサイズ
- 🔄 **HTML自動置換**: HTMLファイル内の画像名をWebP形式に自動置換
- 📊 **バッチ処理**: 複数のDOCXファイルを一括処理
- 📝 **詳細ログ**: 処理状況を詳細に記録

## 🚀 クイックスタート

### 1. インストール

```bash
# リポジトリをクローン
git clone <repository-url>
cd img2webp

# 必要なパッケージをインストール
pip install python-docx Pillow
```

### 2. ファイル配置

```
img2webp/
├── docxs/          # 処理対象のDOCXファイル
├── images/         # 元画像ファイル（JPG/PNG/WebP）
└── html/           # 画像名置換対象のHTMLファイル（オプション）
```

### 3. 実行

```bash
python main.py
```

## 📋 使用方法

### DOCXファイルの形式

テーブル内で以下の形式で画像名を記述してください：

| コード | 画像名 |
|--------|--------|
| COMFRPTC09 | ＜画像＞image-name-01 |
| GSTFRPTA15 | ＜画像名＞image-name-02 |

**対応パターン:**
- `＜画像＞image-name-01`
- `＜画像名＞image-name-02`
- `＜画像1＞image-name-03`
- `＜画像（補足）＞image-name-04`

### 設定カスタマイズ

`config.py`で以下の設定を変更できます：

```python
# 画像サイズ設定
WIDTH_MAP = {
    "COMFRPTC09": [[1800, 1200], [1200, 800], [900, 600], [500, 333]],
    "GSTFRPTA15": [[900, 0], [500, 0]],  # 高さ0はアスペクト比保持
}

# HTML画像名置換順序
HTML_IMAGE_REPLACE_ORDER = {
    "COMFRPTC09": [1800, 1200, 900, 500],
    "GSTFRPTA15": [900, 500],
}

# WebP品質設定
WEBP_QUALITY = 85
```

## 📁 出力構造

```
output/
├── ファイル名1/
│   ├── image-name-011800.webp
│   ├── image-name-011200.webp
│   └── image-name-01900.webp
└── ファイル名2/
    └── image-name-021800.webp
```

## 🔄 HTML画像名置換機能

### 動作概要

1. **自動検索**: `html/`ディレクトリでDOCXファイル名と同じHTMLファイルを検索
2. **画像名抽出**: DOCXから抽出した画像名情報を取得
3. **自動置換**: HTML内の画像ファイル名をWebP形式に置換
4. **ファイル更新**: 置換後のHTMLファイルを保存

### 置換例

**置換前:**
```html
<img src="sample-image-01.jpg" alt="サンプル画像">
<img src="sample-image-02.png" alt="サンプル画像2">
```

**置換後（COMFRPTC09設定の場合）:**
```html
<img src="sample-image-011800.webp" alt="サンプル画像">
<img src="sample-image-021200.webp" alt="サンプル画像2">
```

## 🛠️ トラブルシューティング

### よくある問題と解決方法

| 問題 | 解決方法 |
|------|----------|
| 画像ファイルが見つからない | `images/`ディレクトリにファイルが存在するか確認 |
| DOCXファイルが読み込めない | ファイルが破損していないか確認 |
| 変換に失敗する | 画像ファイルが破損していないか、対応形式か確認 |
| 再変換したい | `output/`内の対象フォルダを削除してから再実行 |
| HTML置換が動作しない | HTMLファイル名がDOCXファイル名と一致しているか確認 |

## 📊 対応形式

### 入力形式
- JPG/JPEG
- PNG
- WebP

### 出力形式
- WebP（複数サイズ）

## 📝 ログ機能

処理の詳細情報は以下のファイルに保存されます：

- `.logs/LOG.log`: 詳細な処理ログ
- `.logs/all_image_names.json`: 全ファイルの画像名情報
- `.logs/all_converted_images.txt`: 変換済み画像ファイル一覧

## 🔧 必要な環境

- **Python**: 3.7以上
- **パッケージ**:
  - `python-docx`: DOCXファイル読み込み
  - `Pillow`: 画像処理

## 📈 更新履歴

- **v1.0**: 初期バージョン（DOCX解析とWebP変換）
- **v1.1**: ログ機能追加
- **v1.2**: 複数サイズ対応
- **v1.3**: アスペクト比保持機能
- **v1.4**: HTML画像名置換機能追加

## 🤝 貢献

バグ報告や機能改善の提案は、IssueまたはPull Requestでお願いします。

## 📄 ライセンス

このプロジェクトのライセンスについては、プロジェクトのライセンスファイルを参照してください。